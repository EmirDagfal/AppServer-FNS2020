openapi: 3.0.0

info:
  title: API FNS 2020
  description: "API destinada al control del sistema de Telegestion para la demo de la Fiesta Nacional del Sol 2020"
  contact:
    email: emirdagfal@gmail.com
  version: 1.0.0

servers:
- url: localhost:3000

paths:

  /alerts:
    post:
      tags: [Alerts]
      summary: Crear una alerta
      operationId: postAlerts
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Alert'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Alerts]
      summary: Obtener alertas
      operationId: getAlerts
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Alert'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Alerts]
      summary: Actualizar alertas
      operationId: patchAlerts
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Alert'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Alerts]
      summary: Eliminar alertas
      operationId: deleteAlerts
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /alerts/{_id}:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Alerts]
      summary: Crear una alerta
      operationId: postAlert
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Alert'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Alerts]
      summary: Obtener alertas
      operationId: getAlert
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Alert'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Alerts]
      summary: Actualizar alertas
      operationId: patchAlert
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Alert'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Alerts]
      summary: Eliminar alertas
      operationId: deleteAlert
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /apps:
    post:
      tags: [Apps]
      summary: Crear una aplicación
      operationId: postApps
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/App'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Apps]
      summary: Obtener aplicaciónes
      operationId: getApps
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/App'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Apps]
      summary: Actualizar aplicaciónes
      operationId: patchApps
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Apps]
      summary: Eliminar aplicaciónes
      operationId: deleteApps
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /apps/{_id}:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Apps]
      summary: Crear una aplicación
      operationId: postApp
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/App'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Apps]
      summary: Obtener aplicaciónes
      operationId: getApp
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/App'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Apps]
      summary: Actualizar aplicaciónes
      operationId: patchApp
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/App'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Apps]
      summary: Eliminar aplicaciónes
      operationId: deleteApp
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /client:
    post:
      tags: [Clients]
      summary: Crear un cliente
      operationId: postClients
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Client'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Clients]
      summary: Obtener clientes
      operationId: getClients
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Client'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Clients]
      summary: Actualizar clientes
      operationId: patchClients
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Clients]
      summary: Eliminar clientes
      operationId: deleteClients
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /client/{_id}:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Clients]
      summary: Crear un cliente
      operationId: postClient
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Client'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Clients]
      summary: Obtener clientes
      operationId: getClient
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Client'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Clients]
      summary: Actualizar clientes
      operationId: patchClient
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Client'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Clients]
      summary: Eliminar clientes
      operationId: deleteClient
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}

  /devices:
    post:
      tags: [Devices]
      summary: Crear un dispositivo
      operationId: postDevices
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Device'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Devices]
      summary: Obtener dispositivos
      operationId: getDevices
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Devices]
      summary: Actualizar dispositivos
      operationId: patchDevices
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Devices]
      summary: Eliminar dispositivos
      operationId: deleteDevices
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
          
  /devices/{_id}:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Devices]
      summary: Crear un dispositivo
      operationId: postDevice
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Device'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Devices]
      summary: Obtener dispositivos
      operationId: getDevice
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Device'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Devices]
      summary: Actualizar dispositivos
      operationId: patchDevice
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Devices]
      summary: Eliminar dispositivos
      operationId: deleteDevice
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}

  /devices/{_id}/data:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Data]
      summary: Crear un dato
      operationId: postData
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Data'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Data]
      summary: Obtener datos
      operationId: getData
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Data'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Data]
      summary: Actualizar datos
      operationId: patchData
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Data'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Data]
      summary: Eliminar datos
      operationId: deleteData
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}

  /zones:
    post:
      tags: [Zones]
      summary: Crear una zona
      operationId: postZones
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Zone'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Zones]
      summary: Obtener zonas
      operationId: getZones
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Zone'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Zones]
      summary: Actualizar zonas
      operationId: patchZones
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Zones]
      summary: Eliminar zonas
      operationId: deleteZones
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /zones/{_id}:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Zones]
      summary: Crear una zona
      operationId: postZone
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Zone'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Zones]
      summary: Obtener zonas
      operationId: getZone
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Zone'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Zones]
      summary: Actualizar zonas
      operationId: patchZone
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Zones]
      summary: Eliminar zonas
      operationId: deleteZone
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}

  /zone_grups:
    post:
      tags: [Zone_Groups]
      summary: Crear un grupo de zonas
      operationId: postZone_Groups
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Zone_Group'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Zone_Groups]
      summary: Obtener grupos de zonas
      operationId: getZone_Groups
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Zone_Group'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Zone_Groups]
      summary: Actualizar grupos de zonas
      operationId: patchZone_Groups
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone_Group'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Zone_Groups]
      summary: Eliminar grupos de zonas
      operationId: deleteZone_Groups
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}
  
  /zone_grups/{_id}:
    parameters:
      - in: path
        name: _id
        description: El id del recurso
        schema: 
          type: string
          format: uuid
          example: 5e1a0651741b255ddda996c4
        required: true
    post:
      tags: [Zone_Groups]
      summary: Crear un grupo de zonas
      operationId: postZone_Group
      responses:
        201:
          description: Recurso creado exitosamente
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/Zone_Group'
        400:
          description: Datos incorrectos o mala sintaxis
          content: {}
        500:
          description: Error al crear el recurso
          content: {}
    get:
      tags: [Zone_Groups]
      summary: Obtener grupos de zonas
      operationId: getZone_Group
      responses:
        201:
          description: Recurso obtenido exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Zone_Group'
        500:
          description: Error al obtener el recurso
          content: {}
    patch:
      tags: [Zone_Groups]
      summary: Actualizar grupos de zonas
      operationId: patchZone_Group
      responses:
        200:
          description: Recurso actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Zone_Group'
        500:
          description: Error al actualizar el recurso
          content: {}
    delete:
      tags: [Zone_Groups]
      summary: Eliminar grupos de zonas
      operationId: deleteZone_Group
      responses:
        202:
          description: Recurso eliminado exitosamente (response sin contenido)
          content: {}
        500:
          description: Error al eliminar el recurso
          content: {}


components:
  schemas:
  
    Alert:
      required:
      - dev_id
      - type
      - timestamp
      type: object
      properties:
        dev_id:
          type: string
          description: ID unico ligado al dispositivo
        type:
          type: string
          enum: [POWER COMMUNICATION]
          description: Tipo de alerta
          example: POWER
        viewed:
          type: boolean
          description: Alerta vista
          example: false
        timestamp:
          type: string
          format: date-time
          description: Timestamp (en segundos) al momento de recibir el dato
          example: 1996-12-19T16:39:57-08:00
    
    App:
      required:
        - app_id
        - name
        - version
      type: object
      properties:
        app_id:
          type: string
          description: ID unico correspondiente a la aplicacion
        name:
          type: string
          description: Nombre de la aplicacion
          enum: [SmartCell-LoRa]
          example: SmartCell-LoRa
        vesion:
          type: string
          example: 1.0.1
        description:
          type: string
          description: Descripcion breve de la aplicacion
          example: Aplicacion de luminarias publicas controladas por LoRaWAN
    
    Client:
      required:
        - client_id
        - name
      type: object
      properties:
        client_id:
          type: string
          description: ID unico correspondiente al cliente
        name:
          type: string
          description: Nombre del cliente
          example: Municipalidad de la Ciudad de San Juan
        apps:
          type: array
          items:
            type: string
            enum: [SmartCell-LoRa]
            description: ID de las aplicaciones a las que esta suscripto el cliente
            example: SmartCell-LoRa
    
    Data:
      required:
      - dev_id
      - timestamp
      type: object
      properties:
        dev_id:
          type: string
          description: ID unico ligado al dispositivo
        power:
          type: number
          format: float
          description: Consumo de potencia medida en el dispositivo
          example: 215.7
        energy:
          type: number
          format: unsigned int
          description: Consumo de energia indicada por medidor externo
          example: 152
        dimming:
          type: number
          format: unsigned int
          description: Niver de atenuacion de la luz
        timestamp:
          type: string
          format: date-time
          description: Timestamp (en segundos) al momento de recibir el dato
          example: 1996-12-19T16:39:57-08:00
          
    Device:
      required:
      - dev_id
      - app_id
      - client_id
      - type
      type: object
      properties:
        dev_id:
          type: string
          description: ID unico correspondiente al dispositivo
        type:
          type: string
          enum: [LORA]
          description: Tipo de dispositivo segun su tecnologia de comunicacion
          example: LORA
        app_id:
          type: string
          description: ID unico correspondiente a la aplicacion
        client_id:
          type: string
          description: ID unico correspondiente al cliente
        location:
          required:
          - lat
          - lon
          type: object
          description: Ubicacion en latitud y longitud del dispositivo
          properties:
            lat:
              type: number
              format: float
            lon:
              type: number
              format: float
          example: [-31.534976 -68.540897]
        EUI:
          type: string
          format: byte
          description: Device-EUI unico ligado al dispositivo LoRa
          example: 0080000004001FAB
          
    Zone:
      required:
      - zone_id
      - name
      - geofence
      type: object
      properties:
        zone_id:
          type: string
          description: ID unico correspondiente a la zona
        name:
          type: string
          description: Nombre de la zona
          example: Zona_1
        geofence:
          type: array
          items:
            type: object
            required:
            - lat
            - lon
            description: Ubicacion en latitud y longitud
            properties:
                lat:
                  type: number
                  format: float
                lon:
                  type: number
                  format: float
          description: Geofence de la zona (conjunto de ubicaciones [lat,log] que demarcan la zona)
          example: [-31.534976 -68.540897]
          
    Zone_Group:
        required:
        - zone_group_id
        - name
        - zones
        type: object
        properties:
          zone_group_id:
            type: string
            description: ID unico correspondiente al grupo de zonas
          name:
            type: string
            description: Nombre del grupo de zonas
            example: Grupo A
          zones:
            type: array
            items:
              type: object
              properties:
                  zone_id:
                    type: string
              description: Arreglo de zonas
              example: [zone_id_1, zone_id_2, zone_id_3]
              